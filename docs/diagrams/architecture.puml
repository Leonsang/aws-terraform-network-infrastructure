@startuml Arquitectura del Sistema de Detecci贸n de Fraude

!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v16.0/dist
!include AWSPuml/AWSCommon.puml
!include AWSPuml/Storage/SimpleStorageService.puml
!include AWSPuml/Analytics/Glue.puml
!include AWSPuml/Analytics/Redshift.puml
!include AWSPuml/Analytics/Athena.puml
!include AWSPuml/Analytics/Kinesis.puml
!include AWSPuml/Compute/Lambda.puml
!include AWSPuml/Database/DynamoDB.puml
!include AWSPuml/ApplicationIntegration/SimpleNotificationService.puml
!include AWSPuml/ManagementGovernance/CloudWatch.puml
!include AWSPuml/Analytics/QuickSight.puml
!include AWSPuml/Security/KeyManagementService.puml
!include AWSPuml/Security/IdentityandAccessManagement.puml

skinparam linetype ortho
skinparam rectangle {
    BackgroundColor<<Raw>> LightYellow
    BackgroundColor<<Processed>> LightGreen
    BackgroundColor<<Analytics>> LightBlue
    BackgroundColor<<Security>> LightPink
    BorderColor Black
    ArrowColor Black
}

' T铆tulo
title Arquitectura Lakehouse para Detecci贸n de Fraude Financiero

' Seguridad
rectangle "Seguridad" as SecurityZone <<Security>> {
    KeyManagementService(kms, "KMS", "Encriptaci贸n")
    IdentityandAccessManagement(iam, "IAM", "Control de acceso")
}

' Definir zonas
rectangle "Raw Zone (Bronze) " as RawZone <<Raw>> {
    SimpleStorageService(rawBucket, "Raw Bucket", "Datos sin procesar")
    Glue(rawCrawler, "Glue Crawler", "Catalogaci贸n")
    note right of rawBucket
        Formato: CSV
        Particionamiento: Fecha
        Retenci贸n: 30 d铆as
    end note
}

rectangle "Processed Zone (Silver) " as ProcessedZone <<Processed>> {
    SimpleStorageService(processedBucket, "Processed Bucket", "Datos limpios")
    Glue(etlJob, "Glue ETL Job", "Transformaci贸n")
    Lambda(qualityCheck, "Lambda Quality", "Validaci贸n de calidad")
    note right of processedBucket
        Formato: Parquet
        Compresi贸n: Snappy
        Particionamiento: Fecha, Tipo
    end note
}

rectangle "Analytics Zone (Gold) " as AnalyticsZone <<Analytics>> {
    SimpleStorageService(analyticsBucket, "Analytics Bucket", "Vistas materializadas")
    Redshift(redshift, "Redshift Cluster", "Data Warehouse")
    Athena(athena, "Athena", "Consultas ad-hoc")
    QuickSight(quicksight, "QuickSight", "Dashboards")
    note right of analyticsBucket
        Formato: Parquet
        Vistas: Materializadas
        Retenci贸n: 1 a帽o
    end note
}

' Ingesta de datos
rectangle "Ingesta de Datos" {
    Lambda(kaggleDownloader, "Kaggle Downloader", "Descarga autom谩tica")
    Kinesis(kinesisStream, "Kinesis Stream", "Ingesta en tiempo real")
    Lambda(realtimeProcessor, "Realtime Processor", "Procesamiento en tiempo real")
    note right of kinesisStream
        Shards: 2
        Retenci贸n: 24h
        TTL: 7 d铆as
    end note
}

' Monitoreo
rectangle "Monitoreo y Alertas" {
    CloudWatch(cloudwatch, "CloudWatch", "M茅tricas y logs")
    SimpleNotificationService(sns, "SNS", "Notificaciones")
    note right of cloudwatch
        M茅tricas: Personalizadas
        Logs: Estructurados
        Alertas: SNS
    end note
}

' Almacenamiento de estad铆sticas
DynamoDB(dynamodb, "DynamoDB", "Estad铆sticas de tarjetas")
note right of dynamodb
    TTL: 30 d铆as
    ndices: GSI
    Capacidad: On-demand
end note

' Flujo de datos - Batch
kaggleDownloader --> rawBucket : "Carga inicial"
rawBucket --> rawCrawler : "Catalogaci贸n"
rawCrawler --> etlJob : "Metadatos"
rawBucket --> etlJob : "Lectura"
etlJob --> qualityCheck : "Validaci贸n"
qualityCheck --> processedBucket : "Datos validados"
processedBucket --> analyticsBucket : "Agregaciones"
analyticsBucket --> redshift : "Carga"
analyticsBucket --> athena : "Consulta"
redshift --> quicksight : "Visualizaci贸n"
athena --> quicksight : "Visualizaci贸n"

' Flujo de datos - Tiempo real
kinesisStream --> realtimeProcessor : "Eventos"
realtimeProcessor --> dynamodb : "Actualizaci贸n"
realtimeProcessor --> processedBucket : "Almacenamiento"
realtimeProcessor --> sns : "Alertas de fraude"

' Seguridad
kms --> rawBucket : "Encriptaci贸n"
kms --> processedBucket : "Encriptaci贸n"
kms --> analyticsBucket : "Encriptaci贸n"
iam --> kaggleDownloader : "Permisos"
iam --> etlJob : "Permisos"
iam --> realtimeProcessor : "Permisos"

' Monitoreo
etlJob ..> cloudwatch : "Logs y m茅tricas"
qualityCheck ..> cloudwatch : "Logs y m茅tricas"
realtimeProcessor ..> cloudwatch : "Logs y m茅tricas"
cloudwatch --> sns : "Alertas"

@enduml 